<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
         "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="common">
    <resultMap id="UserResult" type="User" >
        <id column="USER_ID" property="userId" jdbcType="CHAR" />
        <result column="USER_NAME" property="userName" jdbcType="CHAR" />
        <result column="PASSWORD" property="password" jdbcType="CHAR" />
        <result column="EMAIL" property="email" jdbcType="CHAR" />
        <result column="TEL_NO" property="telNo" jdbcType="CHAR" />
        <result column="ROLE" property="role" jdbcType="CHAR" />
        <result column="STATUS" property="status" jdbcType="CHAR" />
    </resultMap>
    <sql id="userCol" >
        USER_ID, USER_NAME, PASSWORD, EMAIL, TEL_NO, ROLE, STATUS
    </sql>
    
    <select id="selectOneUser" resultMap="UserResult" parameterType="java.lang.String" >
        SELECT 
        <include refid="userCol" />
        FROM TB_USER
        WHERE USER_ID = #{userId,jdbcType=CHAR}
    </select>
    
    <select id="selectUserList" resultMap="UserResult" parameterType="map" >
        SELECT 
        <include refid="userCol" />
        FROM TB_USER
    </select>
    
    <insert id="insertOneUser" parameterType="User">
        INSERT INTO TB_USER (<include refid="userCol" />)
        VALUES 
            (#{userId,jdbcType=CHAR}, 
             #{userName,jdbcType=CHAR}, 
             #{password,jdbcType=CHAR}, 
             #{email,jdbcType=CHAR}, 
             #{telNo,jdbcType=CHAR}, 
             #{role,jdbcType=VARCHAR},
             #{status,jdbcType=CHAR})
    </insert>
    
    <update id="updateOneUser" parameterType="User" >
        UPDATE TB_USER
        SET USER_NAME = #{userName,jdbcType=CHAR},
            PASSWORD = #{password,jdbcType=CHAR},
            EMAIL = #{email,jdbcType=CHAR},
            TEL_NO = #{telNo,jdbcType=CHAR},
            ROLE = #{role,jdbcType=VARCHAR},
            STATUS = #{status,jdbcType=CHAR}
        WHERE USER_ID = #{userId,jdbcType=CHAR}
    </update>
    
    <delete id="deleteOneUser" parameterType="java.lang.String">
        DELETE FROM TB_USER
        WHERE USER_ID = #{userId,jdbcType=CHAR}
    </delete>
    
    
    <resultMap id="ProductGroupResult" type="ProductGroup" >
        <id column="GROUP_ID" property="groupId" jdbcType="CHAR" />
        <result column="GROUP_NAME" property="groupName" jdbcType="CHAR" />
    </resultMap>
    
    <select id="selectOneProductGroup" resultMap="ProductGroupResult" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Feb 18 20:26:36 CST 2016.
    -->
        SELECT GROUP_ID, GROUP_NAME
        FROM TB_PRODUCT_GROUP
        WHERE GROUP_ID = #{groupId,jdbcType=CHAR}
    </select>
    
    <select id="selectAllProductGroup" resultMap="ProductGroupResult" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Feb 18 20:26:36 CST 2016.
    -->
        SELECT GROUP_ID, GROUP_NAME
        FROM TB_PRODUCT_GROUP
    </select>
    
    <insert id="insertOneProductGroup" parameterType="ProductGroup" >
        INSERT INTO TB_PRODUCT_GROUP (GROUP_ID, GROUP_NAME)
        VALUES (#{groupId,jdbcType=CHAR}, #{groupName,jdbcType=CHAR})
    </insert>
    
    <delete id="deleteOneProductGroup" parameterType="java.lang.String" >
        DELETE FROM TB_PRODUCT_GROUP
        WHERE GROUP_ID = #{groupId,jdbcType=CHAR}
    </delete>
    
    <resultMap id="ProductTypeResult" type="ProductType" >
        <id column="GROUP_ID" property="groupId" jdbcType="CHAR" />
        <id column="TYPE_ID" property="typeId" jdbcType="CHAR" />
        <result column="NAME" property="name" jdbcType="CHAR" />
        <result column="UNIT" property="unit" jdbcType="CHAR" />
        <result column="REF_IN_PRICE" property="refInPrice" jdbcType="DECIMAL" />
        <result column="REF_OUT_PRICE" property="refOutPrice" jdbcType="DECIMAL" />
        <result column="DEC_NO" property="decNo" jdbcType="SMALLINT" />
        <result column="REMARK" property="remark" jdbcType="CHAR" />
        <result column="NORM" property="norm" jdbcType="CHAR" />
        <association property="productGroup" column="GROUP_ID" select="selectOneProductGroup"/>
    </resultMap>
    
    <sql id="productTypeCol" >
        GROUP_ID,TYPE_ID,NAME,UNIT,REF_IN_PRICE,REF_OUT_PRICE,DEC_NO,REMARK,NORM
    </sql>
    
    <select id="selectMulProductType" parameterType="map" resultMap="ProductTypeResult">
        SELECT
            <include refid="productTypeCol" />
        FROM
            TB_PRODUCT_TYPE
        <where>
            <if test="groupId != null and groupId != ''">
	            GROUP_ID = #{groupId,jdbcType=CHAR}
	        </if>
	        <if test="typeId != null and typeId != ''">
	            AND TYPE_ID = #{typeId,jdbcType=CHAR}
	        </if>
	        <if test="name != null and name != ''">
	            AND NAME like CONCAT('%',#{name,jdbcType=CHAR},'%')
	        </if>
        </where> 
    </select>
    <select id="selectOneProductType" parameterType="map" resultMap="ProductTypeResult">
        SELECT
           <include refid="productTypeCol"/>
        FROM
            TB_PRODUCT_TYPE
        WHERE GROUP_ID = #{groupId,jdbcType=CHAR}
          AND TYPE_ID = #{typeId,jdbcType=CHAR}
    </select>
    
    <update id="updateOneProductType" parameterType="ProductType">
    UPDATE TB_PRODUCT_TYPE
    SET NAME = #{name,jdbcType=CHAR},
        UNIT = #{unit,jdbcType=CHAR},
        REF_IN_PRICE = #{refInPrice,jdbcType=DECIMAL},
        REF_OUT_PRICE = #{refOutPrice,jdbcType=DECIMAL},
        DEC_NO = #{decNo,jdbcType=SMALLINT},
        REMARK = #{remark,jdbcType=CHAR},
        NORM = #{norm,jdbcType=CHAR}
    WHERE GROUP_ID = #{groupId,jdbcType=CHAR}
        AND TYPE_ID = #{typeId,jdbcType=CHAR}
    </update>
    
    <insert id="insertOneProductType" parameterType="ProductType">
    INSERT INTO TB_PRODUCT_TYPE (<include refid="productTypeCol"/>)
    VALUES (#{groupId,jdbcType=CHAR}, #{typeId,jdbcType=CHAR}, #{name,jdbcType=CHAR}, 
      #{unit,jdbcType=CHAR}, #{refInPrice,jdbcType=DECIMAL}, #{refOutPrice,jdbcType=DECIMAL}, 
      #{decNo,jdbcType=SMALLINT}, #{remark,jdbcType=CHAR}, #{norm,jdbcType=CHAR})
    </insert>
    
    <delete id="deleteOneProductType" parameterType="map">
        DELETE FROM TB_PRODUCT_TYPE
        WHERE GROUP_ID = #{groupId,jdbcType=CHAR}
          AND TYPE_ID = #{typeId,jdbcType=CHAR}
    </delete>
    
</mapper>